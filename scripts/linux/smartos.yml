app-id: com.ledokoz.smartos
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk

command: smartos

finish-args:
  - --share=network
  - --share=ipc
  - --socket=x11
  - --device=all
  - --allow=bluetooth
  - --filesystem=home:ro
  - --filesystem=xdg-config/smartos:create

modules:
  - name: smartos
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin
      - mkdir -p /app/share/smartos
      - cp -r ../../../engine /app/share/smartos/
      - cp ../../../core/config/configuration.yaml /app/share/smartos/
      - pip3 install --prefix=/app -r /app/share/smartos/engine/requirements.txt
      - cat > /app/bin/smartos << 'EOF'
        #!/bin/bash
        cd /app/share/smartos/engine
        exec python3 -m homeassistant --config $HOME/.smartos/config
        EOF
      - chmod +x /app/bin/smartos
    sources:
      - type: dir
        path: ../../..
        skip:
          - .git
          - tests
          - __pycache__
          - "*.pyc"
