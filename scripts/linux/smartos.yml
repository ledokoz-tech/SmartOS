app-id: com.ledokoz.smartos
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk

command: smartos

finish-args:
  - --share=network
  - --share=ipc
  - --socket=x11
  - --device=all
  - --allow=bluetooth
  - --filesystem=home:ro
  - --filesystem=xdg-config/smartos:create

modules:
  - name: smartos
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin
      - mkdir -p /app/share/smartos
      - cp -r ../engine /app/share/smartos/
      - cp ../core/config/configuration.yaml /app/share/smartos/
      - ln -s /app/share/smartos/engine/homeassistant /app/bin/hass
    sources:
      - type: dir
        path: ../../..
        skip:
          - .git
          - tests
          - __pycache__
          - "*.pyc"

  - name: python3-aiohttp
    buildsystem: simple
    build-commands:
      - pip3 install --no-deps --prefix=/app aiohttp
    sources:
      - type: archive
        url: https://pypi.org/packages/source/a/aiohttp/aiohttp-3.9.1.tar.gz
        sha256: 8fc49a87ac269d02c5c4a8c8b95d2d6b1b5b5b1b5b5b5b5b5b5b5b5b5b5b5b5b5b5

  - name: python3-dependencies
    buildsystem: simple
    build-commands:
      - pip3 install --no-deps --prefix=/app zeroconf bcrypt PyJWT pyOpenSSL orjson SQLAlchemy pillow
    sources: []
